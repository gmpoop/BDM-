<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/output.css">
    <link rel="stylesheet" href="../styles/userProfile.css">
    <title>Perfil de Usuario</title>
</head>
<body>
    <div class="container_main">
        <div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg mt-10">
            <div class="flex items-center">
                <div class="w-24 h-24 rounded-full overflow-hidden border-2 border-gray-300">
                    <img id="imagen-perfil" src="https://via.placeholder.com/150" alt="Avatar de Usuario" class="object-cover w-full h-full">
                </div>
                <div class="ml-6">
                    <h1 id="nombre-usuario" class="text-2xl font-semibold text-gray-800">Cargando...</h1>
                    <p id="alias-usuario" class="text-gray-500">@usuario</p>
                    <p id="email-usuario" class="text-gray-600 text-sm">email@example.com</p>
                </div>
                <div class="ml-auto flex space-x-4">
                    <a href="./userEdit.html">
                        <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 flex items-center justify-center w-40">
                            <i class="fas fa-edit mr-2"></i> Editar Perfil
                        </button>
                    </a>
                    <button id="cerrar-sesion" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 flex items-center justify-center w-40">
                        <i class="fas fa-sign-out-alt mr-2"></i> Cerrar Sesión
                    </button>
                </div>
            </div>
            <div class="mt-8">
                <h3 class="text-xl font-semibold text-gray-800">Información Personal</h3>
                <div class="grid grid-cols-2 gap-6 mt-4">
                    <div>
                        <label class="text-gray-600">Fecha de Nacimiento</label>
                        <p class="text-gray-800">01/01/1990</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Género</label>
                        <p class="text-gray-800">Masculino</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Fecha de Registro</label>
                        <p class="text-gray-800">01/08/2024</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Última Modificación</label>
                        <p class="text-gray-800">03/09/2024</p>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <a href="./chat.html">
                        <button class="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600">
                            <i class="fas fa-comments mr-2"></i> Ir al Chat
                        </button>
                    </a>
                    <button id="solicitudTutor" class="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600">
                        <i class="fas fa-chalkboard-teacher mr-2"></i> Solicitar ser Tutor
                    </button>
                </div>
            </div>
        </div>
        <div class="course-container_main">
            <h2>Cursos Inscritos</h2>
            <div class="course-list">
                <!-- Cursos se actualizarán dinámicamente -->
            </div>
        </div>
    </div>

    <script>
        async function cargarPerfilUsuario() {
            try {
                const response = await fetch('controller.php?action=getUser&id=' + userId);
                const usuario = await response.json();
                document.getElementById('imagen-perfil').src = usuario.ruta_foto || 'https://via.placeholder.com/150';
                document.getElementById('nombre-usuario').textContent = usuario.nombre_completo || 'Usuario';
                document.getElementById('alias-usuario').textContent = `@${usuario.alias || 'alias'}`;
                document.getElementById('email-usuario').textContent = usuario.email || 'email@example.com';
                // Actualiza la información personal
                document.querySelector('.grid-cols-2').innerHTML = `
                    <div>
                        <label class="text-gray-600">Fecha de Nacimiento</label>
                        <p class="text-gray-800">${usuario.fecha_nacimiento || '01/01/1990'}</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Género</label>
                        <p class="text-gray-800">${usuario.genero || 'Masculino'}</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Fecha de Registro</label>
                        <p class="text-gray-800">${usuario.fecha_registro || '01/08/2024'}</p>
                    </div>
                    <div>
                        <label class="text-gray-600">Última Modificación</label>
                        <p class="text-gray-800">${usuario.ultimo_cambio || '03/09/2024'}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error al cargar el perfil del usuario:', error);
            }
        }

        async function cargarCursosInscritos() {
            try {
                const response = await fetch('controller.php?action=getUserCourses&id=' + userId);
                const cursos = await response.json();
                const courseList = document.querySelector('.course-list');
                courseList.innerHTML = '';
                cursos.forEach(curso => {
                    const cursoDiv = document.createElement('div');
                    cursoDiv.classList.add('course');
                    cursoDiv.setAttribute('onclick', `openCourse('${curso.titulo}')`);
                    cursoDiv.innerHTML = `
                        <img src="${curso.imagen}" alt="${curso.titulo}">
                        <h3>${curso.titulo}</h3>
                        <p>Progreso: ${curso.progreso}%</p>
                    `;
                    courseList.appendChild(cursoDiv);
                });
            } catch (error) {
                console.error('Error al cargar los cursos inscritos:', error);
            }
        }

        cargarPerfilUsuario();
        cargarCursosInscritos();

        document.getElementById('cerrar-sesion').addEventListener('click', async () => {
            const response = await fetch('usuariosControl.php?action=logout', { method: 'POST' });
            if (response.ok) {
                alert('Sesión cerrada');
                window.location.href = 'login.html';
            } else {
                alert('Error al cerrar sesión');
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
</body>
</html>
